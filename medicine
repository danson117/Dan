<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÆ∂Â∫≠Ëó•ÁÆ±Êô∫ËÉΩË°® v6.2 (MeptinÁâà)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        body { background-color: #f8fafc; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .sort-icon { display: inline-block; vertical-align: middle; margin-left: 4px; opacity: 0.5; }
        .sort-active { opacity: 1; color: #2563eb; }
        th { user-select: none; cursor: pointer; transition: background-color 0.2s; }
        th:hover { background-color: #e2e8f0; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // --- ÂàùÂßãÊï∏ÊìöÂ∫´ ---
    const INITIAL_MEDICATIONS = [
        // Êñ∞Â¢û: Meptin (User Request)
        { id: 32, name: 'Meptin Syrup 5mcg', category: 'cough', tags: ['Ê∞£Âñò', 'Êì¥ÂºµÊ∞£ÁÆ°'], strength: 'Â∞àÁî®', strengthVal: 4.5, rec: 'best', sleep: 'none', sideEffect: 'ÂøÉË∑≥/ÊâãÈúá', food: 'empty', price: 'med', kid: 'ok', kidDose: '5ml x 2Ê¨°', gen: 'Procaterol', note: 'ËàíÂºµÊ∞£ÁÆ°Áî®ÔºåËá®Áî®ÂâçÊêñÂãª' },

        // Batch 3 (Fluimucil)
        { id: 31, name: 'Fluimucil A 100mg', category: 'cough', tags: ['ÂåñÁó∞', 'Ê©ôÊ®πÁ≤â'], strength: '‰∏≠Âº∑', strengthVal: 3.5, rec: 'best', sleep: 'none', sideEffect: 'ËÉÉÊ∞£', food: 'full', price: 'med', kid: 'ok', kidDose: '1ÂåÖ x 2-3Ê¨°', gen: 'N/A', note: 'Ê©ôÂë≥È°ÜÁ≤íÔºåÈúÄÊ≤ñÊ∞¥È£≤' },

        // Batch 2
        { id: 26, name: 'Beclazone 50mcg', category: 'nose', tags: ['Ê∞£ÁÆ°ÊïèÊÑü', 'È°ûÂõ∫ÈÜá'], strength: 'Âº∑Êïà', strengthVal: 4.5, rec: 'good', sleep: 'none', sideEffect: 'ÈµùÂè£Áò°', food: 'empty', price: 'med', kid: 'caution', kidDose: '1Âô¥ x 2Ê¨°', gen: 'N/A', note: 'È†êÈò≤ÊÄßÂê∏ÂÖ•ÂäëÔºåÁî®ÂæåÈúÄÊº±Âè£' },
        { id: 27, name: 'Avamys ÈºªÂô¥Âäë', category: 'nose', tags: ['ÈºªÊïèÊÑü', 'È°ûÂõ∫ÈÜá'], strength: 'Âº∑Êïà', strengthVal: 4, rec: 'best', sleep: 'none', sideEffect: 'ÊµÅÈºªË°Ä', food: 'empty', price: 'high', kid: 'ok', kidDose: '1Âô¥ x 1Ê¨°', gen: '2‰ª£', note: 'Êñ∞‰∏Ä‰ª£Âô¥ÂäëÔºåÂâØ‰ΩúÁî®Â∞ë' },
        { id: 28, name: 'Singulair 5mg', category: 'nose', tags: ['Ê∞£ÁÆ°/Èºª', 'ÂíÄÂöºÁâá'], strength: '‰∏≠Âº∑', strengthVal: 3.5, rec: 'good', sleep: 'none', sideEffect: 'ÊÉÖÁ∑í', food: 'empty', price: 'high', kid: 'ok', kidDose: '1Á≤í x 1Ê¨°', gen: 'N/A', note: 'È†ÜÁàæÂØßÔºåÈï∑ÊúüÊéßÂà∂Áî®' },
        { id: 30, name: 'Actein È°ÜÁ≤í', category: 'cough', tags: ['ÂåñÁó∞', 'Ê©ôÊ®πÈ°û'], strength: '‰∏≠Á≠â', strengthVal: 3, rec: 'good', sleep: 'none', sideEffect: 'ËÉÉ‰∏çÈÅ©', food: 'full', price: 'med', kid: 'ok', kidDose: 'ÂçäÂåÖ x 2Ê¨°', gen: 'N/A', note: 'ÈáùÂ∞çÊøÉÁó∞ÔºåÈúÄÊ≤ñÊ∞¥È£≤' },

        // Batch 1
        { id: 22, name: 'ÊäóÈÅéÊïèÈºªÁÇéÂáùËÜ†', category: 'external', tags: ['ÈºªÊïèÊÑü', 'Áâ©ÁêÜ'], strength: 'ËºîÂä©', strengthVal: 2, rec: 'good', sleep: 'none', sideEffect: 'Ê•µÂ∞ë', food: 'empty', price: 'med', kid: 'ok', kidDose: 'ÈÅ©Èáè x 3Ê¨°', gen: '-', note: 'Áâ©ÁêÜÊÄßÈòªÈöîËá¥ÊïèÊ∫ê' },
        { id: 23, name: 'Hypromellose Eye', category: 'external', tags: ['Áúº‰πæ', 'ÊªãÊΩ§'], strength: 'Ê∫´Âíå', strengthVal: 1, rec: 'good', sleep: 'none', sideEffect: 'ÁÑ°', food: 'empty', price: 'low', kid: 'ok', kidDose: '1Êª¥ x 4Ê¨°', gen: '-', note: '‰∫∫ÈÄ†Ê∑öÊ∞¥' },
        { id: 25, name: 'LCRxx ÈºªÂÆâËàí', category: 'nose', tags: ['Ê¥óÈºª', 'Ê∏ÖÊΩî'], strength: 'Ê∫´Âíå', strengthVal: 1, rec: 'good', sleep: 'none', sideEffect: 'ÁÑ°', food: 'empty', price: 'med', kid: 'ok', kidDose: 'ÈÅ©Èáè x 2Ê¨°', gen: '-', note: 'ÈùûËó•ÊÄßÊ∏ÖÊΩî' },

        // Ê†∏ÂøÉËó•Áâ©
        { id: 21, name: 'Fluifort Syrup 9%', category: 'cough', tags: ['Âº∑ÂäõÂåñÁó∞'], strength: 'Âº∑Êïà', strengthVal: 4, rec: 'best', sleep: 'none', sideEffect: 'ËÖ∏ËÉÉ', food: 'full', price: 'med', kid: 'ok', kidDose: '5ml x 2Ê¨°', gen: '-', note: 'ÈáùÂ∞çÊøÉÁó∞‰∏çÁúºÁûì' },
        { id: 17, name: 'Brufen ‰∏∏', category: 'pain', tags: ['Ê≠¢Áóõ', 'ÈÄÄÁáí'], strength: 'Âº∑Êïà', strengthVal: 4, rec: 'best', sleep: 'none', sideEffect: 'ÂÇ∑ËÉÉ', food: 'full', price: 'low', kid: 'caution', kidDose: 'Ëó•Ê∞¥‰Ω≥', gen: '-', note: 'ÂñâÂö®Áóõ/È´òÁáíÈ¶ñÈÅ∏' },
        { id: 18, name: 'Brufen Ëó•Ê∞¥', category: 'pain', tags: ['Ê≠¢Áóõ', 'ÈÄÄÁáí'], strength: 'Âº∑Êïà', strengthVal: 4, rec: 'best', sleep: 'none', sideEffect: 'ÂÇ∑ËÉÉ', food: 'full', price: 'med', kid: 'ok', kidDose: '7ml x 3Ê¨°', gen: '-', note: 'ÂÖíÁ´•È´òÁáíÈ¶ñÈÅ∏ (ÊåâÈ´îÈáç)' },
        { id: 2, name: 'Bendrol Á¥´Ê∞¥', category: 'nose', tags: ['Êî∂ÈºªÊ∞¥', 'Âä©Áú†'], strength: 'Âº∑Êïà', strengthVal: 4, rec: 'neutral', sleep: 'high', sideEffect: 'Âè£‰πæ', food: 'empty', price: 'low', kid: 'ok', kidDose: '5ml x 3Ê¨°', gen: '1‰ª£', note: 'ÈùûÂ∏∏ÁúºÁûìÔºåÁù°ÂâçÁî®' },
        { id: 3, name: 'Actifed ÈªÉÊ∞¥', category: 'nose', tags: ['ÈÄöÈºªÂ°û'], strength: 'Âº∑Êïà', strengthVal: 4, rec: 'neutral', sleep: 'med', sideEffect: 'ÂøÉË∑≥', food: 'empty', price: 'low', kid: 'ok', kidDose: '5ml x 3Ê¨°', gen: '1‰ª£', note: 'ÂøÉËáü‰∏çÂ•ΩÊÖéÁî®' },
        { id: 11, name: 'Tussidex Forte', category: 'cough', tags: ['Ê≠¢Âí≥'], strength: 'Âº∑Êïà', strengthVal: 4, rec: 'good', sleep: 'med', sideEffect: 'È†≠Êöà', food: 'full', price: 'med', kid: 'ok', kidDose: '5ml x 3Ê¨°', gen: '-', note: 'Âº∑ÊïàÊ≠¢Âí≥ÁÑ°È¥âÁâá' },
        { id: 7, name: 'Aerius ‰∏∏', category: 'nose', tags: ['ÊäóÊïè'], strength: '‰∏≠Á≠â', strengthVal: 3, rec: 'best', sleep: 'none', sideEffect: 'Ê•µÂ∞ë', food: 'empty', price: 'high', kid: 'caution', kidDose: 'Ëó•Ê∞¥‰Ω≥', gen: '3‰ª£', note: 'ÂâØ‰ΩúÁî®ÊúÄÂ∞ë' },
        { id: 6, name: 'Adezio Ëó•Ê∞¥', category: 'nose', tags: ['ÊäóÊïè'], strength: '‰∏≠Á≠â', strengthVal: 3, rec: 'good', sleep: 'low', sideEffect: 'ÂæÆÂÄ¶', food: 'empty', price: 'med', kid: 'ok', kidDose: '5ml x 1Ê¨°', gen: '2‰ª£', note: 'ZyrtecÂêåÈ°ûÔºåÁù°ÂâçÈ£ü' },
        { id: 19, name: 'Progesic Ê∞¥', category: 'pain', tags: ['Ê≠¢Áóõ', 'ÈÄÄÁáí'], strength: '‰∏≠Á≠â', strengthVal: 3, rec: 'good', sleep: 'none', sideEffect: 'ÂÇ∑ËÇù', food: 'empty', price: 'low', kid: 'ok', kidDose: '10ml x 4Ê¨°', gen: '-', note: 'PanadolÊàê‰ªΩ (ÊØè4Â∞èÊôÇ)' },
        { id: 20, name: 'Pabron Gold A', category: 'pain', tags: ['Á∂úÂêàÊÑüÂÜí'], strength: '‰∏≠Á≠â', strengthVal: 3, rec: 'bad', sleep: 'med', sideEffect: '‰æùË≥¥', food: 'full', price: 'med', kid: 'caution', kidDose: 'ÊåâÂåÖË£ù', gen: '-', note: 'Êàê‰ªΩÈõúÔºå‰∏çÂèØÊ∑∑ÂêÉ' },
        { id: 4, name: 'Chlorpheniramine', category: 'nose', tags: ['ÊäóÊïè'], strength: 'Ê®ôÊ∫ñ', strengthVal: 2, rec: 'neutral', sleep: 'med', sideEffect: 'Âè£‰πæ', food: 'empty', price: 'low', kid: 'ok', kidDose: '2.5ml x 3Ê¨°', gen: '1‰ª£', note: 'ÂÇ≥Áµ±ÈªÉ‰∏∏' },
        { id: 16, name: 'Flemizyme ‰∏∏', category: 'cough', tags: ['Ê∂àËÖ´'], strength: 'ËºîÂä©', strengthVal: 1, rec: 'good', sleep: 'none', sideEffect: 'Ê•µÂ∞ë', food: 'full', price: 'low', kid: 'ok', kidDose: '1Á≤í x 3Ê¨°', gen: '-', note: 'Ê∂àËÖ´ÈÖµÁ¥†' },
    ];

    const STORAGE_KEY_MEMBERS = 'famBox_members_v1';
    const STORAGE_KEY_HIDDEN = 'famBox_hidden_v1';

    // ÂÆâÂÖ®Â≠òÂèñ LocalStorage ÁöÑ Helper
    const safeGetItem = (key, defaultValue) => {
        try {
            const saved = localStorage.getItem(key);
            return saved ? JSON.parse(saved) : defaultValue;
        } catch (e) {
            console.warn('LocalStorage access denied, using default value.');
            return defaultValue;
        }
    };

    const safeSetItem = (key, value) => {
        try {
            localStorage.setItem(key, JSON.stringify(value));
        } catch (e) {
            console.warn('LocalStorage save failed (sandboxed environment).');
        }
    };

    const App = () => {
        // --- State ---
        const [medications, setMedications] = useState(INITIAL_MEDICATIONS);
        
        // ‰ΩøÁî®ÂÆâÂÖ®ËÆÄÂèñ
        const [hiddenIds, setHiddenIds] = useState(() => safeGetItem(STORAGE_KEY_HIDDEN, []));
        const [viewMode, setViewMode] = useState('active'); // 'active' | 'deleted'
        
        // ‰ΩøÁî®ÂÆâÂÖ®ËÆÄÂèñ
        const [members, setMembers] = useState(() => safeGetItem(STORAGE_KEY_MEMBERS, [
            { id: 1, name: 'Áà∏Áà∏', items: [] },
            { id: 2, name: 'Â™ΩÂ™Ω', items: [] },
            { id: 3, name: 'BB', items: [] }
        ]));

        const [activeMemberId, setActiveMemberId] = useState(members[0]?.id || 1);
        const [isEditingName, setIsEditingName] = useState(false);
        const [tempName, setTempName] = useState('');

        // ÊêúÂ∞ãËàáÁØ©ÈÅ∏
        const [searchTerm, setSearchTerm] = useState('');
        const [selectedCategory, setSelectedCategory] = useState('all');
        const [filterNoSleep, setFilterNoSleep] = useState(false);
        const [filterKidSafe, setFilterKidSafe] = useState(false);

        // ÊéíÂ∫èË®≠ÂÆö (È†êË®≠Âº∑Â∫¶Áî±È´òËá≥‰Ωé)
        const [sortConfig, setSortConfig] = useState({ key: 'strengthVal', direction: 'desc' });

        // --- Persistence Effects (Ëá™ÂãïÂÑ≤Â≠ò - ÂÆâÂÖ®Áâà) ---
        useEffect(() => {
            safeSetItem(STORAGE_KEY_MEMBERS, members);
        }, [members]);

        useEffect(() => {
            safeSetItem(STORAGE_KEY_HIDDEN, hiddenIds);
        }, [hiddenIds]);

        // --- Derived State ---
        const activeMember = members.find(m => m.id === activeMemberId) || members[0];

        // --- Logic ---
        const filteredData = useMemo(() => {
            let data = medications.filter(med => {
                // 1. Ë¶ñÂúñÈÅéÊøæ
                if (viewMode === 'active' && hiddenIds.includes(med.id)) return false;
                if (viewMode === 'deleted' && !hiddenIds.includes(med.id)) return false;

                // 2. ÊêúÂ∞ã
                const matchesSearch = med.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                      med.note.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                      med.tags.some(t => t.includes(searchTerm));
                if (!matchesSearch) return false;

                // 3. È°ûÂà•
                if (selectedCategory !== 'all' && med.category !== selectedCategory) return false;

                // 4. ÈÄ≤ÈöéÁØ©ÈÅ∏
                if (filterNoSleep && med.sleep !== 'none') return false;
                if (filterKidSafe && med.kid === 'no') return false;

                return true;
            });

            // 5. ÊéíÂ∫è
            data.sort((a, b) => {
                let aValue = a[sortConfig.key];
                let bValue = b[sortConfig.key];

                if (sortConfig.key === 'rec') {
                    const score = { 'best': 3, 'good': 2, 'neutral': 1, 'bad': 0 };
                    aValue = score[a.rec] || 0; 
                    bValue = score[b.rec] || 0;
                }
                if (sortConfig.key === 'sleep') {
                    const score = { 'none': 0, 'low': 1, 'med': 2, 'high': 3 };
                    aValue = score[a.sleep] || 0;
                    bValue = score[b.sleep] || 0;
                }
                if (sortConfig.key === 'kid') {
                    const score = { 'ok': 2, 'caution': 1, 'no': 0 };
                    aValue = score[a.kid] || 0;
                    bValue = score[b.kid] || 0;
                }

                if (aValue < bValue) return sortConfig.direction === 'asc' ? -1 : 1;
                if (aValue > bValue) return sortConfig.direction === 'asc' ? 1 : -1;
                return 0;
            });
            return data;
        }, [medications, hiddenIds, viewMode, searchTerm, selectedCategory, sortConfig, filterNoSleep, filterKidSafe]);

        // --- Member Actions ---
        const createMember = () => {
            const newId = Date.now();
            const newMembers = [...members, { id: newId, name: `Êñ∞ÊàêÂì° ${members.length + 1}`, items: [] }];
            setMembers(newMembers);
            setActiveMemberId(newId);
        };

        const deleteMember = (id) => {
            if (members.length <= 1) {
                alert("ÊúÄÂ∞ë‰øùÁïô‰∏ÄÂÄãÊàêÂì°ÂêçÂñÆ");
                return;
            }
            if (!confirm("Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÂÄãÊàêÂì°ÁöÑÂêçÂñÆÂóéÔºü")) return;
            const newMembers = members.filter(m => m.id !== id);
            setMembers(newMembers);
            if (activeMemberId === id) setActiveMemberId(newMembers[0].id);
        };

        const updateMemberName = () => {
            if (!tempName.trim()) return;
            setMembers(members.map(m => m.id === activeMemberId ? { ...m, name: tempName } : m));
            setIsEditingName(false);
        };

        const toggleItemInMember = (medId) => {
            setMembers(members.map(member => {
                if (member.id === activeMemberId) {
                    const exists = member.items.includes(medId);
                    return {
                        ...member,
                        items: exists ? member.items.filter(id => id !== medId) : [...member.items, medId]
                    };
                }
                return member;
            }));
        };

        // --- Drug Actions ---
        const softDelete = (id) => {
            setHiddenIds([...hiddenIds, id]);
        };

        const restore = (id) => {
            setHiddenIds(hiddenIds.filter(hid => hid !== id));
        };

        const handleSort = (key) => {
            setSortConfig(current => ({
                key,
                direction: current.key === key && current.direction === 'desc' ? 'asc' : 'desc'
            }));
        };

        const getSortIcon = (key) => {
            if (sortConfig.key !== key) return <i className="ph ph-arrows-down-up sort-icon"></i>;
            return sortConfig.direction === 'asc' 
                ? <i className="ph ph-arrow-up sort-icon sort-active"></i> 
                : <i className="ph ph-arrow-down sort-icon sort-active"></i>;
        };

        const getGoogleImageLink = (name) => `https://www.google.com/search?tbm=isch&q=${encodeURIComponent(name + ' medicine packaging')}`;

        return (
            <div className="w-full max-w-[1400px] mx-auto bg-white shadow-2xl min-h-screen flex flex-col">
                
                {/* 1. È†ÇÈÉ®Â∞éËà™ËàáÊàêÂì°ÁÆ°ÁêÜÂô® */}
                <div className="bg-slate-900 text-white p-4 sticky top-0 z-30 shadow-lg">
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4">
                        <div>
                            <h1 className="text-2xl font-bold flex items-center gap-2 text-blue-400">
                                <i className="ph ph-first-aid-kit text-3xl"></i> ÂÆ∂Â∫≠Ëó•ÁÆ±Êô∫ËÉΩË°®
                            </h1>
                        </div>
                        
                        {/* Ë¶ñÂúñÂàáÊèõ */}
                        <div className="flex bg-slate-800 rounded-lg p-1 border border-slate-700">
                            <button onClick={() => setViewMode('active')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${viewMode === 'active' ? 'bg-blue-600 text-white shadow' : 'text-gray-400 hover:text-white'}`}>
                                Ëó•Áâ©Â∫´
                            </button>
                            <button onClick={() => setViewMode('deleted')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-1 ${viewMode === 'deleted' ? 'bg-red-600 text-white shadow' : 'text-gray-400 hover:text-white'}`}>
                                <i className="ph ph-trash"></i> Â∑≤ÁßªÈô§ ({hiddenIds.length})
                            </button>
                        </div>
                    </div>

                    {/* ÊàêÂì°ÂêçÂñÆÊéßÂà∂Âè∞ */}
                    <div className="bg-slate-800 rounded-xl p-4 border border-slate-700 shadow-inner">
                        <div className="flex flex-col sm:flex-row gap-4 items-center justify-between">
                            
                            {/* Â∑¶ÂÅ¥ÔºöÈÅ∏ÊìáÊàêÂì° */}
                            <div className="flex items-center gap-3 w-full sm:w-auto">
                                <div className="bg-blue-600 w-10 h-10 rounded-full flex items-center justify-center shadow-lg">
                                    <i className="ph ph-user text-xl"></i>
                                </div>
                                <div className="flex flex-col">
                                    <span className="text-[10px] text-slate-400 uppercase tracking-wider font-bold">Áï∂ÂâçÊàêÂì°ÂêçÂñÆ</span>
                                    
                                    {isEditingName ? (
                                        <div className="flex items-center gap-1 mt-1">
                                            <input type="text" value={tempName} onChange={(e) => setTempName(e.target.value)} 
                                                className="text-black px-2 py-0.5 rounded text-sm w-32 outline-none" autoFocus />
                                            <button onClick={updateMemberName} className="text-green-400 hover:text-green-300"><i className="ph ph-check-circle text-xl"></i></button>
                                        </div>
                                    ) : (
                                        <div className="flex items-center gap-2">
                                            <select 
                                                value={activeMemberId} 
                                                onChange={(e) => setActiveMemberId(Number(e.target.value))}
                                                className="bg-transparent text-white font-bold text-lg border-b border-slate-500 focus:border-blue-400 outline-none cursor-pointer pb-0.5"
                                            >
                                                {members.map(m => <option key={m.id} value={m.id} className="text-black">{m.name}</option>)}
                                            </select>
                                            <button onClick={() => { setTempName(activeMember.name); setIsEditingName(true); }} className="text-slate-500 hover:text-white transition-colors" title="ÊîπÂêç">
                                                <i className="ph ph-pencil-simple"></i>
                                            </button>
                                            <button onClick={() => deleteMember(activeMemberId)} className="text-slate-500 hover:text-red-400 transition-colors" title="Âà™Èô§Ê≠§ÊàêÂì°ÂêçÂñÆ">
                                                <i className="ph ph-trash"></i>
                                            </button>
                                            <button onClick={createMember} className="ml-2 bg-slate-700 hover:bg-slate-600 text-slate-200 px-2 py-1 rounded text-xs flex items-center gap-1 transition-colors border border-slate-600">
                                                <i className="ph ph-plus"></i> Âä†‰∫∫
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Âè≥ÂÅ¥ÔºöËó•Áâ©ÊëòË¶Å */}
                            <div className="flex items-center gap-4 text-sm w-full sm:w-auto bg-slate-900/50 px-4 py-2 rounded-lg border border-slate-700">
                                <div className="flex items-center gap-2">
                                    <span className="text-slate-400">Â∑≤ÈÅ∏Ëó•Áâ©:</span>
                                    <span className="font-bold text-white text-xl text-blue-400">{activeMember.items.length}</span>
                                </div>
                                <div className="h-4 w-px bg-slate-700"></div>
                                <div className="text-xs text-slate-500">
                                    {activeMember.items.length > 0 ? 'Â∑≤ÂÑ≤Â≠òËá≥ÂêçÂñÆ' : 'ÈªûÊìä‰∏ãÊñπ + Âä†ÂÖ•'}
                                </div>
                            </div>
                        </div>
                        
                        {/* ÂêçÂñÆÂÖßÂÆπÈ†êË¶Ω */}
                        {activeMember.items.length > 0 && (
                            <div className="mt-3 pt-3 border-t border-slate-700 flex flex-wrap gap-2 animate-fade-in">
                                {activeMember.items.map(itemId => {
                                    const item = medications.find(m => m.id === itemId);
                                    if (!item) return null; // Â¶ÇÊûúËó•Áâ©Ë¢´ÂÆåÂÖ®ÁßªÈô§
                                    const isDeleted = hiddenIds.includes(itemId);
                                    return (
                                        <span key={itemId} className={`text-xs px-2 py-1 rounded flex items-center gap-1 border ${
                                            isDeleted 
                                            ? 'bg-red-900/30 border-red-800 text-red-300' 
                                            : 'bg-blue-900/50 border-blue-700 text-blue-100'
                                        }`}>
                                            {item.name}
                                            {isDeleted && <span className="text-[10px]">(Â∑≤ÁßªÈô§)</span>}
                                            <button onClick={() => toggleItemInMember(itemId)} className="hover:text-white ml-1"><i className="ph ph-x"></i></button>
                                        </span>
                                    );
                                })}
                            </div>
                        )}
                    </div>
                </div>

                {/* 2. ÁØ©ÈÅ∏Â∑•ÂÖ∑Âàó */}
                <div className="p-4 bg-white border-b border-gray-200 space-y-4">
                    <div className="flex flex-col md:flex-row gap-4 justify-between">
                        <div className="relative flex-1">
                            <i className="ph ph-magnifying-glass absolute left-3 top-2.5 text-gray-400"></i>
                            <input type="text" placeholder={viewMode === 'active' ? "ÊêúÂ∞ãËó•Âêç„ÄÅÂäüÊïà..." : "ÊêúÂ∞ãÂ∑≤ÁßªÈô§ÁöÑËó•Áâ©..."}
                                className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50"
                                value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                        </div>
                        
                        {/* ÈÄ≤ÈöéÁØ©ÈÅ∏ÈñãÈóú */}
                        <div className="flex items-center gap-2">
                            <button 
                                onClick={() => setFilterNoSleep(!filterNoSleep)}
                                className={`px-3 py-2 rounded-lg text-sm font-medium flex items-center gap-2 border transition-all ${filterNoSleep ? 'bg-green-100 border-green-300 text-green-800' : 'bg-white border-gray-200 text-gray-500 hover:bg-gray-50'}`}
                            >
                                <i className={`ph ${filterNoSleep ? 'ph-check-square' : 'ph-square'}`}></i>
                                üü¢ ÁÑ°Áù°ÊÑè
                            </button>
                            <button 
                                onClick={() => setFilterKidSafe(!filterKidSafe)}
                                className={`px-3 py-2 rounded-lg text-sm font-medium flex items-center gap-2 border transition-all ${filterKidSafe ? 'bg-blue-100 border-blue-300 text-blue-800' : 'bg-white border-gray-200 text-gray-500 hover:bg-gray-50'}`}
                            >
                                <i className={`ph ${filterKidSafe ? 'ph-check-square' : 'ph-square'}`}></i>
                                üë∂ Â∞èÁ´•ÈÅ©Áî®
                            </button>
                        </div>
                    </div>

                    <div className="flex flex-wrap gap-2">
                        <button onClick={() => setSelectedCategory('all')} 
                            className={`px-3 py-1.5 rounded-full text-xs font-medium border transition-all ${selectedCategory === 'all' ? 'bg-gray-800 text-white' : 'bg-white text-gray-600 hover:bg-gray-100'}`}>
                            ÂÖ®ÈÉ®
                        </button>
                        {[
                            {id: 'nose', label: 'Èºª/ÊäóÊïè', icon: 'ph-wind', color: 'blue'},
                            {id: 'cough', label: 'Âí≥/ÂñâÂö®', icon: 'ph-cloud-rain', color: 'teal'},
                            {id: 'pain', label: 'Áóõ/Ááí', icon: 'ph-thermometer', color: 'purple'},
                            {id: 'external', label: 'Â§ñÁî®/ÂÖ∂‰ªñ', icon: 'ph-eye', color: 'amber'}
                        ].map(cat => (
                            <button key={cat.id} onClick={() => setSelectedCategory(cat.id)} 
                                className={`px-3 py-1.5 rounded-full text-xs font-medium flex items-center gap-1 border transition-all ${selectedCategory === cat.id ? `bg-${cat.color}-600 text-white border-${cat.color}-600` : `bg-white text-gray-600 hover:bg-${cat.color}-50`}`}>
                                <i className={`ph ${cat.icon}`}></i> {cat.label}
                            </button>
                        ))}
                    </div>
                </div>

                {/* 3. ‰∏ªË°®Ê†º */}
                <div className="flex-1 overflow-x-auto bg-gray-50">
                    <table className="w-full text-left border-collapse min-w-[1100px]">
                        <thead className="bg-gray-200 text-gray-700 uppercase text-xs sticky top-0 z-10 shadow-sm">
                            <tr>
                                <th className="p-3 w-14 text-center">ÂúñÁâá</th>
                                <th className="p-3 w-10 text-center" title="Âä†ÂÖ•Áï∂ÂâçÊàêÂì°ÂêçÂñÆ">ÈÅ∏Âèñ</th>
                                
                                <th className="p-3 w-[18%]" onClick={() => handleSort('name')}>
                                    Ëó•Âêç / Ê®ôÁ±§ {getSortIcon('name')}
                                </th>
                                
                                <th className="p-3 w-16" onClick={() => handleSort('rec')}>
                                    Êé®Ëñ¶ {getSortIcon('rec')}
                                </th>
                                
                                <th className="p-3 w-16" onClick={() => handleSort('strengthVal')}>
                                    Âº∑Â∫¶ {getSortIcon('strengthVal')}
                                </th>
                                
                                <th className="p-3 w-20" onClick={() => handleSort('sleep')}>
                                    Áù°ÊÑè {getSortIcon('sleep')}
                                </th>
                                
                                <th className="p-3 w-16" onClick={() => handleSort('food')}>
                                    È£ΩËÇö {getSortIcon('food')}
                                </th>
                                
                                <th className="p-3 w-24" onClick={() => handleSort('kid')}>
                                    ÂÖíÁ´• {getSortIcon('kid')}
                                </th>
                                
                                <th className="p-3 w-[20%]" onClick={() => handleSort('note')}>
                                    ÂÇôË®ª / ÂâØ‰ΩúÁî® {getSortIcon('note')}
                                </th>
                                
                                <th className="p-3 w-12 text-center">Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-200 text-sm bg-white">
                            {filteredData.map(med => {
                                const isInList = activeMember.items.includes(med.id);
                                return (
                                    <tr key={med.id} className={`hover:bg-blue-50 transition-colors ${isInList ? 'bg-blue-50/60' : ''}`}>
                                        {/* ÂúñÁâáÈÄ£Áµê */}
                                        <td className="p-2 text-center">
                                            <a href={getGoogleImageLink(med.name)} target="_blank" className="block w-10 h-10 bg-gray-100 rounded flex items-center justify-center mx-auto hover:bg-blue-100 hover:text-blue-600 border border-gray-200 text-gray-400">
                                                <i className="ph ph-image text-xl"></i>
                                            </a>
                                        </td>

                                        {/* Âä†ÂÖ•ÂêçÂñÆÊåâÈàï */}
                                        <td className="p-2 text-center">
                                            {viewMode === 'active' && (
                                                <button onClick={() => toggleItemInMember(med.id)} 
                                                    className={`w-8 h-8 rounded-full flex items-center justify-center transition-all ${isInList ? 'bg-blue-600 text-white shadow-md scale-110' : 'bg-gray-100 text-gray-400 hover:bg-blue-200 hover:text-blue-600'}`}
                                                    title={isInList ? `Âæû ${activeMember.name} ÁöÑÂêçÂñÆÁßªÈô§` : `Âä†ÂÖ• ${activeMember.name} ÁöÑÂêçÂñÆ`}>
                                                    {isInList ? <i className="ph ph-check text-lg"></i> : <i className="ph ph-plus text-lg"></i>}
                                                </button>
                                            )}
                                        </td>

                                        {/* Ëó•Âêç */}
                                        <td className="p-3">
                                            <div className="font-bold text-gray-800 text-base">{med.name}</div>
                                            <div className="flex flex-wrap gap-1 mt-1">
                                                {med.tags.map((tag, i) => (
                                                    <span key={i} className={`text-[10px] px-1.5 py-0.5 rounded border ${
                                                        tag.includes('ÈÄÄÁáí') ? 'bg-red-50 text-red-700 border-red-100' :
                                                        tag.includes('Ê≠¢Áóõ') ? 'bg-orange-50 text-orange-700 border-orange-100' :
                                                        'bg-gray-100 text-gray-600 border-gray-200'
                                                    }`}>{tag}</span>
                                                ))}
                                            </div>
                                        </td>

                                        {/* Êé®Ëñ¶Â∫¶ */}
                                        <td className="p-3 text-center">
                                            {med.rec === 'best' ? <i className="ph ph-thumbs-up text-green-600 text-xl"></i> :
                                             med.rec === 'bad' ? <i className="ph ph-thumbs-down text-red-500 text-xl"></i> : 
                                             <span className="text-gray-300">-</span>}
                                        </td>

                                        {/* Âº∑Â∫¶ */}
                                        <td className={`p-3 font-medium ${med.strengthVal >= 4 ? 'text-red-600' : 'text-gray-700'}`}>{med.strength}</td>

                                        {/* Áù°ÊÑè */}
                                        <td className="p-3">
                                            {med.sleep === 'high' ? <span className="text-red-600 font-bold text-xs">Ê•µÁúºÁûì</span> :
                                             med.sleep === 'med' ? <span className="text-orange-500 font-bold text-xs">ÊúâÁù°ÊÑè</span> :
                                             med.sleep === 'low' ? <span className="text-yellow-600 font-bold text-xs">ÂæÆÁù°ÊÑè</span> :
                                             <span className="text-green-600 font-bold text-xs">ÁÑ°</span>}
                                        </td>

                                        {/* È£ΩËÇö */}
                                        <td className="p-3 text-xs">
                                            {med.food === 'full' ? <span className="text-blue-600 font-bold">È£ΩËÇö</span> : <span className="text-gray-400">ÂèØÁ©∫</span>}
                                        </td>

                                        {/* ÂÖíÁ´•‰ªΩÈáè */}
                                        <td className="p-3">
                                            {med.kid === 'no' ? <span className="text-red-500 text-xs font-bold">‰∏çÂèØ</span> : (
                                                <div className="flex flex-col">
                                                    <span className={`text-xs font-bold ${med.kid === 'ok' ? 'text-green-600' : 'text-yellow-600'}`}>
                                                        {med.kid === 'ok' ? 'OK' : 'ÊÖéÁî®'}
                                                    </span>
                                                    <span className="text-xs font-mono text-gray-600 bg-gray-100 px-1 rounded mt-0.5 w-fit">
                                                        {med.kidDose}
                                                    </span>
                                                </div>
                                            )}
                                        </td>

                                        {/* ÂÇôË®ª */}
                                        <td className="p-3 text-xs">
                                            <div className="text-gray-800">{med.note}</div>
                                            {med.sideEffect !== 'ÁÑ°' && med.sideEffect !== 'Ê•µÂ∞ë' && med.sideEffect !== 'Êú™Áü•' && <div className="text-red-500 mt-0.5">‚ö† {med.sideEffect}</div>}
                                        </td>

                                        {/* ÊãÜÈô§/ÈÇÑÂéü ÊåâÈàï */}
                                        <td className="p-3 text-center">
                                            {viewMode === 'active' ? (
                                                <button onClick={() => softDelete(med.id)} className="text-gray-300 hover:text-red-500 hover:bg-red-50 p-2 rounded transition-colors" title="ÁßªÈô§ (ÁßªËá≥ÂõûÊî∂Á≠í)">
                                                    <i className="ph ph-trash text-lg"></i>
                                                </button>
                                            ) : (
                                                <button onClick={() => restore(med.id)} className="text-green-500 hover:text-green-700 hover:bg-green-50 p-2 rounded transition-colors flex items-center gap-1 mx-auto" title="ÈÇÑÂéü">
                                                    <i className="ph ph-arrow-counter-clockwise text-lg"></i>
                                                </button>
                                            )}
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                    {filteredData.length === 0 && (
                        <div className="p-12 text-center text-gray-400 flex flex-col items-center">
                            <i className="ph ph-ghost text-4xl mb-2"></i>
                            <p>{viewMode === 'active' ? 'Ê≤íÊúâÊâæÂà∞Áõ∏ÈóúËó•Áâ©' : 'ÂõûÊî∂Á≠íÊòØÁ©∫ÁöÑ'}</p>
                        </div>
                    )}
                </div>

            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>

</body>
</html>
